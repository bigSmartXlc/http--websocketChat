import{d as x,r as m,o as M,x as f,y as h,z as a,J as b,K as D,L as P,M as B,A as K,N as A,O as C,P as T,Q as I,_ as $,R as N}from"#entry";const O=()=>({sendChatMessage:async(n,u)=>{try{const r={model:"Qwen/QwQ-32B",messages:u.map(l=>({role:l.role,content:l.content})),temperature:.7,max_tokens:2e3},o=await fetch("https://api.siliconflow.cn/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(r)});if(!o.ok){const l=await o.json().catch(()=>({}));throw new Error(l.error?.message||`API请求失败: ${o.status}`)}return(await o.json()).choices[0]?.message?.content||""}catch(r){throw console.error("发送消息到DeepSeek AI失败:",r),r}},sendChatMessageStream:async(n,u,r,o)=>{try{const p={model:"Qwen/QwQ-32B",messages:u.map(e=>({role:e.role,content:e.content})),temperature:.7,max_tokens:2e3,stream:!0},l=await fetch("https://api.siliconflow.cn/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(p)});if(!l.ok)throw new Error(`API请求失败: ${l.status}`);const g=l.body?.getReader();if(!g)throw new Error("无法获取响应体的读取器");const y=new TextDecoder;let i="";for(;;){const{done:e,value:t}=await g.read();if(e)break;i+=y.decode(t,{stream:!0});const d=i.split(`
`);i=d.pop()||"";for(const v of d)if(v.startsWith("data:")){const w=v.substring(5).trim();if(w==="[DONE]"){o();return}try{const S=JSON.parse(w).choices[0]?.delta?.content||"";S&&r(S)}catch(k){console.error("解析流式响应数据失败:",k)}}}o()}catch(p){throw console.error("流式发送消息失败:",p),p}},validateApiKey:async n=>{try{return(await fetch("https://api.deepseek.com/v1/models",{method:"GET",headers:{Authorization:`Bearer ${n}`}})).ok}catch{return!1}}}),Q={class:"chat-container"},E={class:"message-content"},z={key:0,class:"message ai"},j={class:"chat-input"},J=["disabled"],V=["disabled"],L={key:0,class:"chat-settings"},R=x({__name:"ChatComponent",setup(_){const s=m([]),c=m(""),n=m(!1),u=m(null),r=m(!1),o=m(""),{sendChatMessageStream:p}=O();M(()=>{const i=localStorage.getItem("deepseekApiKey");i&&(o.value=i),s.value.push({id:"welcome",role:"ai",content:"您好！我是DeepSeek AI助手，有什么可以帮助您的吗？"});const t=new URLSearchParams(window.location.search).get("appid");t&&(c.value=t)});const l=()=>{localStorage.setItem("deepseekApiKey",o.value),r.value=!1},g=async()=>{if(!c.value.trim()||n.value||!o.value)return;const i={id:Date.now().toString(),role:"user",content:c.value};s.value.push(i),c.value="",await I(),y(),n.value=!0;try{const e=(Date.now()+1).toString(),t={id:e,role:"ai",content:""};s.value.push(t),await p(o.value,[i],d=>{const v=s.value.findIndex(w=>w.id===e);v!==-1&&(s.value[v].content+=d,s.value=[...s.value])},()=>{console.log("请求完成");const d=s.value.findIndex(v=>v.id===e);d!==-1&&!s.value[d].content.trim()&&(s.value[d].content="抱歉，我暂时无法回答这个问题。",s.value=[...s.value])})}catch(e){console.error("API错误:",e);const t={id:(Date.now()+2).toString(),role:"ai",content:"抱歉，API请求失败，请检查您的API Key是否正确。"};s.value.push(t)}finally{n.value=!1,await I(),y()}},y=()=>{u.value&&(u.value.scrollTop=u.value.scrollHeight)};return(i,e)=>(h(),f("div",Q,[a("div",{class:"chat-messages",ref_key:"messagesContainer",ref:u},[(h(!0),f(D,null,P(s.value,t=>(h(),f("div",{key:t.id,class:B(["message",t.role])},[a("div",E,K(t.content),1)],2))),128)),n.value?(h(),f("div",z,[...e[4]||(e[4]=[a("div",{class:"message-content"},[a("span",{class:"typing-indicator"},[a("span"),a("span"),a("span")])],-1)])])):b("",!0)],512),a("div",j,[A(a("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>c.value=t),onKeyup:T(g,["enter"]),placeholder:"输入您的问题...",disabled:n.value,class:"message-input"},null,40,J),[[C,c.value]]),a("button",{onClick:g,disabled:n.value||!c.value.trim(),class:"send-button"}," 发送 ",8,V)]),r.value?(h(),f("div",L,[e[5]||(e[5]=a("h3",null,"API设置",-1)),A(a("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>o.value=t),placeholder:"请输入API Key",type:"password",class:"settings-input"},null,512),[[C,o.value]]),a("button",{onClick:l,class:"save-button"},"保存设置"),a("button",{onClick:e[2]||(e[2]=t=>r.value=!1),class:"close-button"},"关闭")])):b("",!0),a("button",{onClick:e[3]||(e[3]=t=>r.value=!r.value),class:"settings-button"}," ⚙️ ")]))}}),U=$(R,[["__scopeId","data-v-db751e89"]]),F=x({__name:"index",setup(_){return(s,c)=>(h(),N(U))}});export{F as default};
